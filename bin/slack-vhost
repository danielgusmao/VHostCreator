#!/bin/bash

#GERADOR AUTOMÁTICO DE VIRTUALHOSTS PARA O SLACKWARE
# AUTHOR     :: Matheus Fidelis
# GITHUB     :: https://github.com/msfidelis
# TWITTER    :: http://twitter.com.br/fidelissauro
# S.O.       :: SLACKWARE 14.*

###########################################################
# MODO DE USAR: 
#               vhost-creator.sh -h teste.meusite.com -d /var/www/html/meusite

#PEGA OS ARGUMENTOS
while getopts 'h:d:' opt ; do
  case $opt in
    h) VHOST=$OPTARG ;;
    d) DIRECTORY=$OPTARG ;;
  esac
done


#CRIA O REGISTRO NO ARQUIVO HOSTS
echo "[+] CRIANDO O REGISTRO NO ARQUIVO HOSTS DO SISTEMA"
echo "127.0.0.1     $VHOST" >> /etc/hosts

echo $VHOST
echo $DIRECTORY

if [ -d "$DIRECTORY" ]; then
    #CRIA O VIRTUALHOST
    echo "[+] CRIANDO O VIRTUALHOST BASEADO APONTANDO PARA $DIRECTORY"
    echo "
    <VirtualHost *:80>
            ServerName $VHOST
            ServerAlias www.$VHOST
            DocumentRoot $DIRECTORY
            <Directory $DIRECTORY/>
                    Options Indexes FollowSymLinks
                    #MultiViews
                    AllowOverride All
                    Order allow,deny
                    allow from all
            </Directory>
            ErrorLog ${APACHE_LOG_DIR}/$VHOST.error.log
            CustomLog ${APACHE_LOG_DIR}/$VHOST.access.log combined
    </VirtualHost>
    " >> /etc/httpd/httpd.conf
    
    echo "[+] HABILITANDO O VHOST NO SISTEMA"
    a2ensite $VHOST.conf

    echo "[+] REINICIANDO O APACHE"
    /etc/rc.d/rc.httpd restart
    
else 
    echo [-] DIRETÓRIO DO SITE NÃO ENCONTRADO... 
fi
